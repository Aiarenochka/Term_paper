<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.5/dist/css/bootstrap.min.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body class="container mt-4">
<h2>üìñ –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h2>

<div class="mb-3">
    <a th:href="@{/books/add_book}" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥—É
    </a>
</div>

<form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
        <label for="genre" class="form-label">–ñ–∞–Ω—Ä</label>
        <select id="genre" class="form-select" name="genre">
            <option value="">–£—Å—ñ</option>
            <option th:each="g : ${genres}" th:value="${g}" th:text="${g}" th:selected="${genre == g}"></option>
        </select>
    </div>

    <div class="col-md-3">
        <label for="read" class="form-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</label>
        <select id="read" class="form-select" name="read">
            <option value="">–£—Å—ñ</option>
            <option value="true" th:selected="${read == 'true'}">–ü—Ä–æ—á–∏—Ç–∞–Ω—ñ</option>
            <option value="false" th:selected="${read == 'false'}">–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ</option>
        </select>
    </div>

    <div class="col-md-2">
        <label for="minRating" class="form-label">–ú—ñ–Ω. –æ—Ü—ñ–Ω–∫–∞</label>
        <select id="minRating" class="form-select" name="minRating">
            <option value="">–£—Å—ñ</option>
            <option th:each="i : ${#numbers.sequence(0,5)}"
                    th:value="${i}" th:text="${i}" th:selected="${minRating == i}"></option>
        </select>
    </div>

    <div class="col-md-3">
        <label for="sort" class="form-label">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞</label>
        <select id="sort" class="form-select" name="sort">
            <option value="">–ë–µ–∑ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</option>
            <option value="title" th:selected="${sort == 'title'}">–ù–∞–∑–≤–æ—é</option>
            <option value="year" th:selected="${sort == 'year'}">–†–æ–∫–æ–º</option>
            <option value="rating" th:selected="${sort == 'rating'}">–û—Ü—ñ–Ω–∫–æ—é</option>
        </select>
    </div>

    <div class="col-md-1 d-flex align-items-end">
        <button class="btn btn-primary w-100" type="submit">–§—ñ–ª—å—Ç—Ä</button>
    </div>
</form>

<table class="table table-bordered table-striped align-middle">
    <thead class="table-light">
    <tr>
        <th>ID</th><th>–ù–∞–∑–≤–∞</th><th>–ê–≤—Ç–æ—Ä</th><th>–ñ–∞–Ω—Ä</th>
        <th>–†—ñ–∫</th><th>–û—Ü—ñ–Ω–∫–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î—ñ—è</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="book : ${books}">
        <td th:text="${book.id}"></td>
        <td th:text="${book.title}"></td>
        <td th:text="${book.author}"></td>
        <td th:text="${book.genre}"></td>
        <td th:text="${book.year}"></td>

        <td>
            <form th:action="@{/books/rate}" method="post" class="d-flex align-items-center gap-2">
                <input type="hidden" name="id" th:value="${book.id}"/>
                <input type="number" min="0" max="5" name="rating"
                       th:value="${book.rating}" class="form-control form-control-sm"
                       style="width: 70px;" />
                <button type="submit" class="btn btn-outline-primary btn-sm">üíæ</button>
            </form>
        </td>

        <td>
            <form th:action="@{/books/updateReadStatus}" method="post">
                <input type="hidden" name="id" th:value="${book.id}" />
                <select name="readStatus" class="form-select form-select-sm"
                        onchange="this.form.submit()">
                    <option value="–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${book.readStatus == '–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                    <option value="–£ –ø—Ä–æ—Ü–µ—Å—ñ" th:selected="${book.readStatus == '–£ –ø—Ä–æ—Ü–µ—Å—ñ'}">–£ –ø—Ä–æ—Ü–µ—Å—ñ</option>
                    <option value="–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${book.readStatus == '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                </select>
            </form>
        </td>

        <td class="d-flex flex-column gap-2">
            <a th:href="@{'/books/edit/' + ${book.id}}" class="btn btn-warning btn-sm">
                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
            </a>
            <a th:href="@{'/books/delete/' + ${book.id}}"
               class="btn btn-danger btn-sm"
               th:onclick="'return confirm(\'–í–∏–¥–∞–ª–∏—Ç–∏ –∫–Ω–∏–≥—É –∑ ID ' + ${book.id} + '?\')'">
                üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
            </a>
        </td>
    </tr>
    </tbody>
</table>

<a class="btn btn-secondary mt-3" th:href="@{/}">‚¨ÖÔ∏è –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
</body>
</html>
