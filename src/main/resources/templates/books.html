<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.5/dist/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/webjars/bootstrap-icons/1.11.3/font/bootstrap-icons.css}" />
    <style>
        body {
            background-color: #f8f9fa;
        }
        .book-table {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .table-header {
            background-color: #0d6efd;
            color: white;
        }
        .action-buttons {
            min-width: 150px;
        }
        .rating-form {
            min-width: 120px;
        }
        .status-select {
            min-width: 140px;
        }
        .card-shadow {
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.05);
        }
        .btn-success {
            background-color: #198754;
            border-color: #198754;
        }
        .btn-info {
            background-color: #0dcaf0;
            border-color: #0dcaf0;
        }
    </style>
</head>

<body class="container mt-4">
<div class="card card-shadow p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">üìñ –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h2>
        <div>
            <a th:href="@{/books/add_book}" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥—É
            </a>
            <a th:href="@{/authors}" class="btn btn-info ms-2">
                <i class="bi bi-pen"></i> –ê–≤—Ç–æ—Ä–∏
            </a>
        </div>
    </div>

    <div class="card card-shadow mb-4 p-3">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label for="genre" class="form-label">–ñ–∞–Ω—Ä</label>
                <select id="genre" class="form-select" name="genre">
                    <option value="">–£—Å—ñ</option>
                    <option th:each="g : ${genres}" th:value="${g}" th:text="${g}" th:selected="${genre == g}"></option>
                </select>
            </div>

            <div class="col-md-3">
                <label for="readStatus" class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <select id="readStatus" class="form-select" name="readStatus">
                    <option value="">–£—Å—ñ</option>
                    <option value="–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${readStatus == '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                    <option value="–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${readStatus == '–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                    <option value="–£ –ø—Ä–æ—Ü–µ—Å—ñ" th:selected="${readStatus == '–£ –ø—Ä–æ—Ü–µ—Å—ñ'}">–£ –ø—Ä–æ—Ü–µ—Å—ñ</option>
                </select>
            </div>

            <div class="col-md-2">
                <label for="minRating" class="form-label">–ú—ñ–Ω. –æ—Ü—ñ–Ω–∫–∞</label>
                <select id="minRating" class="form-select" name="minRating">
                    <option value="">–£—Å—ñ</option>
                    <option th:each="i : ${#numbers.sequence(0,5)}"
                            th:value="${i}" th:text="${i}" th:selected="${minRating != null and minRating == i}"></option>
                </select>
            </div>

            <div class="col-md-3">
                <label for="sort" class="form-label">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞</label>
                <select id="sort" class="form-select" name="sort">
                    <option value="">–ë–µ–∑ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</option>
                    <option value="title" th:selected="${sort == 'title'}">–ù–∞–∑–≤–æ—é</option>
                    <option value="year" th:selected="${sort == 'year'}">–†–æ–∫–æ–º</option>
                    <option value="rating" th:selected="${sort == 'rating'}">–û—Ü—ñ–Ω–∫–æ—é</option>
                </select>
            </div>

            <div class="col-md-1 d-flex align-items-end">
                <button class="btn btn-primary w-100" type="submit">
                    <i class="bi bi-funnel"></i> –§—ñ–ª—å—Ç—Ä
                </button>
            </div>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-hover book-table">
            <thead class="table-header">
            <tr>
                <th>ID</th>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–ê–≤—Ç–æ—Ä</th>
                <th>–ñ–∞–Ω—Ä</th>
                <th>–†—ñ–∫</th>
                <th>–û—Ü—ñ–Ω–∫–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th class="action-buttons">–î—ñ—è</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="book : ${books}" class="align-middle">
                <td th:text="${book.id}" class="fw-bold"></td>
                <td th:text="${book.title}"></td>
                <td>
                    <span th:if="${book.author}" th:text="${book.author}"></span>
                    <span th:unless="${book.author}" class="text-muted">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</span>
                </td>
                <td>
                    <span th:if="${book.genre}" th:text="${book.genre}"></span>
                    <span th:unless="${book.genre}" class="text-muted">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</span>
                </td>
                <td th:text="${book.year}"></td>

                <td class="rating-form">
                    <form th:action="@{/books/rate}" method="post" class="d-flex align-items-center gap-2">
                        <input type="hidden" name="id" th:value="${book.id}"/>
                        <input type="number" min="0" max="5" name="rating"
                               th:value="${book.rating}" class="form-control form-control-sm"
                               aria-label="–û—Ü—ñ–Ω–∫–∞ –∫–Ω–∏–≥–∏"/>
                        <button type="submit" class="btn btn-outline-primary btn-sm" aria-label="–ó–±–µ—Ä–µ–≥—Ç–∏ –æ—Ü—ñ–Ω–∫—É">
                            <i class="bi bi-check"></i>
                        </button>
                    </form>
                </td>

                <td class="status-select">
                    <form th:action="@{/books/updateReadStatus}" method="post">
                        <input type="hidden" name="id" th:value="${book.id}" />
                        <select name="readStatus" class="form-select form-select-sm"
                                onchange="this.form.submit()" aria-label="–°—Ç–∞—Ç—É—Å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è">
                            <option value="–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${book.readStatus == '–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                            <option value="–£ –ø—Ä–æ—Ü–µ—Å—ñ" th:selected="${book.readStatus == '–£ –ø—Ä–æ—Ü–µ—Å—ñ'}">–£ –ø—Ä–æ—Ü–µ—Å—ñ</option>
                            <option value="–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" th:selected="${book.readStatus == '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'}">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                        </select>
                    </form>
                </td>

                <td class="action-buttons">
                    <div class="d-flex gap-2">
                        <a th:href="@{'/books/edit/' + ${book.id}}" class="btn btn-warning btn-sm" aria-label="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–Ω–∏–≥—É">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a th:href="@{'/books/delete/' + ${book.id}}"
                           class="btn btn-danger btn-sm"
                           th:onclick="'return confirm(\'–í–∏–¥–∞–ª–∏—Ç–∏ –∫–Ω–∏–≥—É –∑ ID ' + ${book.id} + '?\')'"
                           aria-label="–í–∏–¥–∞–ª–∏—Ç–∏ –∫–Ω–∏–≥—É">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-between mt-4">
        <a class="btn btn-outline-secondary" th:href="@{/}">
            <i class="bi bi-house"></i> –ù–∞ –≥–æ–ª–æ–≤–Ω—É
        </a>
        <div class="text-muted">
            –í—Å—å–æ–≥–æ –∫–Ω–∏–≥: <span th:text="${books.size()}" class="fw-bold"></span>
        </div>
    </div>
</div>
</body>
</html>